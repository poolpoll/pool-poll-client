<dom-module id="poll-chart-bar">
  <template>
    <style>
      :host {
        display: block;
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
    </style>
    <div id="chart-section"></div>
  </template>
  <script>
    Polymer({
      is: 'poll-chart-bar',

      properties: {
        questionDetail: {
          type: Array,
          observer: '_questionDetailChanged'
        }
      },

      _questionDetailChanged: function(questionDetail) {
        questionDetail.forEach(function(question) {
          this.setBarChart(question);
        }.bind(this));
      },

      setBarChart: function(question) {
        var label = question.name;
        var labels = [];
        var backgroundColor = [];
        var borderColor = [];
        var data = [];

        question.options.forEach(function(option) {
          var randomColor = '#' + Math.round(Math.random() * 0xFFFFFF).toString(16);
          labels.push(option.name);
          data.push(option.count);
          backgroundColor.push(randomColor);
          borderColor.push(randomColor);          
        });

        var canvas = document.createElement('canvas');
        canvas.setAttribute('id', 'chart-bar-' + question.id);
        this.$['chart-section'].appendChild(canvas);

        var barChart = new Chart(canvas, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: label,
              data: data,
              borderWidth: 1,
              borderColor: borderColor,
              backgroundColor: backgroundColor              
            }]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true,
                  stepSize: 1
                }
              }]
            }
          }
        });
      }
    })
  </script>
</dom-module>
