<dom-module id="sign-up">
	<template>
		<style>
			.container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				padding-left: 10px;
				padding-right: 10px;
			}
			.button-group {
				@apply(--layout-horizontal);
			}
			.flex {
				@apply(--layout-flex);
			}
		</style>
		<custom-ajax
			id="sign-up-ajax"
			resource-url="auth/sign_up"
			method="post"
			content-type="application/json">
 		</custom-ajax>

		<div class="container">
			<paper-input id="id-input" label="ID" value="{{account}}"></paper-input>
			<paper-input id="name-input" label="Name" value="{{name}}"></paper-input>
			<paper-input id="pwd-input" label="Password" value="{{password}}" type="password"></paper-input>
			<paper-input id="confirm-pwd-input" label="Confirm Password" value="{{confirmPassword}}" type="password"></paper-input>
			<paper-input id="email-input" label="E-Mail" value="{{email}}"></paper-input>

			<div class="button-group">
				<paper-button id="cancel-btn" class="flex" on-tap="cancelSignUp">Cancel</paper-button>
				<paper-button id="sign-up-btn" class="flex" on-tap="signUp" disabled>Sign up</paper-button>
			</div>
		</div>

	</template>
	<script>
		Polymer({
			is: 'sign-up',

			properties: {
				account: {
					type: String
				},

				name: {
					type: String
				},

				password: {
					type: String
				},

				confirmPassword: {
					type: String
				},

				email: {
					type: String
				}
			},

			observers: [
				'autoValidator(account, name, password, confirmPassword, email)'
			],

			listeners: {
				'sign-up-ajax.response': 'signUpResponsed'
			},

			clearScreen: function() {
				this.account = '';
				this.name = '';
				this.password = '';
				this.emai = '';
			},

			cancelSignUp: function() {
				this.clearScreen();
				this.fire('dialog-close');
			},

			signUp: function() {
				var signUpAjax = this.$['sign-up-ajax'];
				signUpAjax.body = {
					account: this.account,
					name: this.name,
					password: this.password,
					email: this.email
				};

				signUpAjax.generateRequest();
				this.fire('spinner-toggle', true);
			},

			signUpResponsed: function(response) {
				this.fire('spinner-toggle', false);
				if(response) {
					app.route = 'sign_in';
					app.title = 'Sign In';

					this.fire('dialog-close', {
						closeCallback: function() { this.fire('toast-toggle', 'Success to Sign Up');}.bind(this)
					});
				} else {
					this.fire('toast-toggle', 'Faield to Sign Up');
				}
			},

			autoValidator: function(account, name, password, confirmPassword, email) {
				if(account && name && password && confirmPassword && email && password === confirmPassword) {
					this.activeButton();
				} else {
					this.deactiveButton();
				}
			},

			activeButton: function() {
				this.$['sign-up-btn'].disabled = false;
			},

			deactiveButton: function() {
				this.$['sign-up-btn'].disabled = true;
			}
		})
	</script>
</dom-module>
