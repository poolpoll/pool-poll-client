<dom-module id="new-poll">
	<template>
		<style>
			.info-container {
				background-color: white;
			}
			.horizontal {
				@apply(--layout-horizontal);
			}
			.flex {
				@apply(--layout-flex);
			}
			.content {
				@apply(--layout-flex);
				padding-left: 2%;
				padding-right: 2%;
			}
		</style>

		<custom-ajax
			id="regist-poll-ajax"
			resource-url="polls/regist"
			method="post"
			content-type="application/json">
		</custom-ajax>

		<div class="info-container">
			<div class="horizontal">
				<paper-input class="content" label="Title" value="{{name}}"></paper-input>
				<drop-down-list class="content" label="Category" resource-name="categories" value="{{categoryId}}"></drop-down-list>
			</div>

			<paper-input class="content" label="Description" value="{{description}}"></paper-input>

			<div class="horizontal">
				<paper-input class="content" label="Start Date" value="{{fromDate}}" type="date"></paper-input>
				<paper-input class="content" label="Due Date" value="{{toDate}}" type="date"></paper-input>
			</div>
		</div>

		<div id="sheet-container" class="sheet-container">
			<new-poll-sheet></new-poll-sheet>
		</div>

		<paper-button on-tap="appendNewPollSheet">add</paper-button>
		<paper-button on-tap="registPoll">regist</paper-button>

	</template>
	<script>
		Polymer({
			is: 'new-poll',

			listeners: {
				'regist-poll-ajax.response': 'pollAjaxResponsed'
			},

			appendNewPollSheet: function() {
				var sheetContainer = this.$['sheet-container'];
				var sheetList = sheetContainer.children;

				for(var i = 0; i < sheetList.length; i++) {
					sheetList[i].closeCollapse();
				};

				var newPollSheet = document.createElement('new-poll-sheet');
				sheetContainer.appendChild(newPollSheet);
			},

			registPoll: function() {
				var sheetContainer = this.$['sheet-container'];
				var questionList = [];

				var sheetList = sheetContainer.children;

				for(var i = 0; i < sheetList.length; i++) {
					questionList.push(sheetList[i].returnValues());
				};

				var registPollAjax = this.$['regist-poll-ajax'];
				registPollAjax.body = {
					name: this.name,
					categoryId: this.categoryId,
					description: this.description,
					fromDate: this.fromDate,
					toDate: this.toDate,
					questionList: questionList
				};
				registPollAjax.generateRequest();
			},

			pollAjaxResponsed: function(event) {
				if(event.currentTarget.lastResponse) {
					page('/my_polls');
				}
			}
		})
	</script>
</dom-module>
