<dom-module id="free-poll-main">
	<template>
		<!-- header content -->
		<free-poll-header title="[[title]]"></free-poll-header>

		<!-- view list -->
		<iron-pages id="pages" attr-for-selected="route" selected="{{route}}">
			<new-poll route="new_poll"></new-poll>
			<my-poll route="my_polls"></my-poll>
			<sign-in route="sign_in"></sign-in>
		</iron-pages>

		<paper-toast id="bottom-toast" class="fit-bottom" text="[[toastMsg]]"></paper-toast>

		<paper-spinner id="spinner"></paper-spinner>

		<free-poll-drawer id="side-menu"></free-poll-drawer>

		<dialog-opener id="dialog-opener"></dialog-opener>
	</template>
	<script>
		Polymer({
			is: 'free-poll-main',

			properties: {

				route: {
					type: String,
					observer: '_routeChanged'
				},

				title: {
					type: String,
				},

				baseUrl: {
					type: String
				}
			},

			ready: function() {
				document.addEventListener('toast-toggle', function(event) {
					var message = event.detail;
					this.toggleToast(message);
				}.bind(this));

				document.addEventListener('spinner-toggle', function(event) {
					var isActive = event.detail;
					this.toggleSpinner(isActive);
				}.bind(this));
			},

			attached: function() {
				if(!app.route || app.route == '') {
					app.route = 'my_polls';
					app.title = 'My Poll';
					app.baseUrl = 'http://localhost:3000/'
				};
			},

			/**
			 * routeUrl이 변경될 때 마다 호출한다.
			 */
			_routeChanged: function(route) {
				this.$['side-menu'].close();
			},

			/**
			 * toast toggle event listener
			 */
			toggleToast: function(message) {
				var toast = this.$['bottom-toast'];
				toast.text = message;
				toast.close();
				toast.toggle();
			},

			/**
			 * spinner toggle event listner
			 */
			toggleSpinner: function(isActive) {
				this.$['spinner'].active = isActive;
			}
		})
	</script>
</dom-module>