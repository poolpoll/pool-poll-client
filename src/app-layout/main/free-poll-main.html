<link rel="import" href="routing.html">

<dom-module id="free-poll-main">
	<template>
		<style>
			:host {
				display: block;
			}
			iron-pages {
				height: 100%;
			}
			.pages {
				height: 100%;
			}
		</style>

		<app-drawer-layout fullbleed>
			<!-- Drawer content -->
			<app-drawer id="drawer" align="right">
				<free-poll-menu-list></free-poll-menu-list>
			</app-drawer>

			<!-- Main content -->
			<app-header-layout has-scrolling-region>
				<app-header fixed>
					<free-poll-header title="[[title]]"></free-poll-header>
				</app-header>

				<iron-pages attr-for-selected="route" selected="{{route}}" on-track="handleTrack">
					<!-- view list -->
					<main-page class="pages" route="main"></main-page>
					<my-poll class="pages" route="my_polls"></my-poll>
					<new-poll class="pages" route="new_poll"></new-poll>
					<poll-list class="pages" route="polls"></poll-list>
					<poll-join class="pages" route="poll_join"></poll-join>
					<poll-charts class="pages" route="poll_charts"></poll-charts>
					<profile-view class="pages" route="profile"></profile-view>
					<sign-in class="pages" route="sign_in"></sign-in>
				</iron-pages>

			</app-header-layout>
		</app-drawer-layout>

		<!-- common utils -->
		<paper-toast id="bottom-toast" class="fit-bottom" text="[[toastMsg]]"></paper-toast>
		<dialog-opener id="dialog-opener"></dialog-opener>
		<custom-localstorage></custom-localstorage>
		<message-dialog></message-dialog>
	</template>

	<script>
		Polymer({
			is: 'free-poll-main',

			properties: {

				route: {
					type: String,
					observer: '_routeChanged'
				},

				title: {
					type: String,
				},

				baseUrl: {
					type: String
				}
			},

			ready: function() {
				document.addEventListener('side-menu-open', function() {
					this.openSideMenu();
				}.bind(this));

				document.addEventListener('toast-toggle', function(event) {
					var message = event.detail;
					this.toggleToast(message);
				}.bind(this));

				document.addEventListener('spinner-toggle', function(event) {
					var isActive = event.detail;
					this.toggleSpinner(isActive);
				}.bind(this));
			},

			handleTrack: function(event) {
				var state = event.detail.state;
				if(state == 'end') {
					if(event.detail.dx) {
						var dx = event.detail.dx;
						if(dx >= 100) {
							this.fire('swipe-to-right');
						} else if (dx <= -100) {
							this.fire('swipe-to-left');
						}
					};

					if (event.detail.dy) {
						var dy = event.detail.dy;
						if(dy >= 100) {
							this.fire('swipe-to-down');
						} else if (dy <= -100) {
							this.fire('swipe-to-up');
						}
					};
				}
			},

			openSideMenu: function() {
				this.$.drawer.open();
			},

			/**
			 * routeUrl이 변경될 때 마다 호출한다.
			 */
			_routeChanged: function(route) {
				if(route == 'my_polls') {
					this.fire('refresh-poll-list');
				}

				this.$.drawer.close();
			},

			/**
			 * toast toggle event listener
			 */
			toggleToast: function(message) {
				var toast = this.$['bottom-toast'];
				toast.text = message;
				toast.close();
				toast.toggle();
			},

			/**
			 * spinner toggle event listner
			 */
			toggleSpinner: function(isActive) {
				// this.$['spinner'].active = isActive;
			}
		})
	</script>
</dom-module>
